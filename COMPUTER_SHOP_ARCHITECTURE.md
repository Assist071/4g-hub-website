# Computer Shop Auto-IP Detection System - Architecture & Data Flow

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CUSTOMER CLIENT                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  1. IPValidation.tsx (React Component)                              â”‚
â”‚     â”œâ”€ Auto-detect IP (via ipify.org API)                          â”‚
â”‚     â”œâ”€ Check database for existing IP                              â”‚
â”‚     â”œâ”€ Show PC selection grid                                      â”‚
â”‚     â”œâ”€ Submit access request                                       â”‚
â”‚     â”œâ”€ Wait for admin approval (realtime listener)                â”‚
â”‚     â””â”€ Auto-redirect on approval                                   â”‚
â”‚                                                                      â”‚
â”‚  2. State Management                                                â”‚
â”‚     â””â”€ React hooks (useState, useEffect)                           â”‚
â”‚                                                                      â”‚
â”‚  3. Network Calls                                                   â”‚
â”‚     â”œâ”€ GET https://api.ipify.org (IP detection)                    â”‚
â”‚     â””â”€ Supabase client library (DB operations)                     â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                    â”‚
          â”‚ (REST/Realtime)                    â”‚
          â”‚                                    â”‚
          â–¼                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SUPABASE BACKEND                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  useComputerShopDatabase.ts (Custom Hook)                          â”‚
â”‚  â”œâ”€ detectClientIP()                                               â”‚
â”‚  â”œâ”€ checkIPExists(ip)                                              â”‚
â”‚  â”œâ”€ requestPCAccess(pcId, ip)          â”Œâ”€ Updates pcs table       â”‚
â”‚  â”œâ”€ grantAccess(pcId, sessionId)       â”œâ”€ Updates sessions table  â”‚
â”‚  â”œâ”€ denyAccess(pcId, sessionId)        â”œâ”€ Returns updated data    â”‚
â”‚  â”œâ”€ endSession(pcId)                   â”‚                          â”‚
â”‚  â”œâ”€ kickClient(pcId)                   â”‚                          â”‚
â”‚  â”œâ”€ setMaintenance(pcId)               â”‚                          â”‚
â”‚  â”œâ”€ restoreFromMaintenance(pcId)       â”‚                          â”‚
â”‚  â””â”€ Subscription handlers              â””â”€ Realtime listeners     â”‚
â”‚                                                                      â”‚
â”‚  PostgreSQL Database (Supabase)                                     â”‚
â”‚  â”‚                                                                   â”‚
â”‚  â”œâ”€ pcs table                                                       â”‚
â”‚  â”‚  â”œâ”€ id (serial PK)                                             â”‚
â”‚  â”‚  â”œâ”€ pc_number (VARCHAR UNIQUE)                                 â”‚
â”‚  â”‚  â”œâ”€ ip_address (VARCHAR, NULL)                                 â”‚
â”‚  â”‚  â”œâ”€ status (VARCHAR: offline/online/pending/maintenance)       â”‚
â”‚  â”‚  â”œâ”€ current_session_id (UUID FK)                               â”‚
â”‚  â”‚  â”œâ”€ session_started_at (TIMESTAMP)                             â”‚
â”‚  â”‚  â”œâ”€ last_seen (TIMESTAMP)                                      â”‚
â”‚  â”‚  â””â”€ Indexes: ip_address, status                                â”‚
â”‚  â”‚                                                                   â”‚
â”‚  â””â”€ sessions table                                                  â”‚
â”‚     â”œâ”€ id (UUID PK)                                                â”‚
â”‚     â”œâ”€ pc_id (INTEGER FK)                                          â”‚
â”‚     â”œâ”€ ip_address (VARCHAR)                                        â”‚
â”‚     â”œâ”€ status (VARCHAR: pending/active/ended/rejected)             â”‚
â”‚     â”œâ”€ started_at, ended_at (TIMESTAMP)                            â”‚
â”‚     â””â”€ Indexes: pc_id, status                                      â”‚
â”‚                                                                      â”‚
â”‚  Realtime Subscriptions (Enabled)                                   â”‚
â”‚  â”œâ”€ pcs.* (all operations on pcs table)                            â”‚
â”‚  â””â”€ sessions.* (all operations on sessions table)                  â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                    â”‚
          â”‚ (REST/Realtime)                    â”‚
          â”‚                                    â”‚
          â–¼                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ADMIN CLIENT                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  1. PCManagementAdmin.tsx (React Component)                         â”‚
â”‚     â”œâ”€ Load all PCs from database                                  â”‚
â”‚     â”œâ”€ Subscribe to realtime updates                               â”‚
â”‚     â”œâ”€ Display table with filters                                  â”‚
â”‚     â”œâ”€ Show running timers (1sec updates)                          â”‚
â”‚     â”œâ”€ Render action buttons per status                            â”‚
â”‚     â””â”€ Handle on-click actions:                                    â”‚
â”‚        â”œâ”€ Grant access (pending â†’ online)                          â”‚
â”‚        â”œâ”€ Deny access (pending â†’ offline)                          â”‚
â”‚        â”œâ”€ End session (online â†’ offline, keep IP)                  â”‚
â”‚        â”œâ”€ Kick client (online â†’ offline, remove IP)                â”‚
â”‚        â”œâ”€ Set maintenance (offline â†’ maintenance)                  â”‚
â”‚        â””â”€ Restore (maintenance â†’ offline)                          â”‚
â”‚                                                                      â”‚
â”‚  2. State Management                                                â”‚
â”‚     â”œâ”€ useState for PCs list                                       â”‚
â”‚     â”œâ”€ useState for elapsed times                                  â”‚
â”‚     â”œâ”€ useEffect for subscriptions & timers                        â”‚
â”‚     â””â”€ useCallback for action handlers                             â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Flow Diagrams

### Customer Flow: New IP (Selection)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Load App â”‚ (Customer visits /validate)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IPValidation Component      â”‚
â”‚ useEffect hook fires       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ detectClientIP()            â”‚ â—„â”€â”€â”€ Custom Hook
â”‚ Fetch ipify.org API         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ IP: 192.168.1.101
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ State: ip = "192.168..."   â”‚
â”‚ setState(step: 'checking') â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ checkIPExists(ip)           â”‚ â—„â”€â”€â”€ Custom Hook
â”‚ Query Supabase             â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ (not found)
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ getAvailablePCs()          â”‚ â—„â”€â”€â”€ Custom Hook
â”‚ Query offline/maintenance  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ [PC-03, PC-04, PC-07, ...]
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ setState(                  â”‚
â”‚   step: 'selection',       â”‚
â”‚   availablePCs: [...]      â”‚
â”‚ )                          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Render PC Grid             â”‚
â”‚ 6 PC cards in grid         â”‚
â”‚ User clicks PC-02          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ handleSelectPC(PC-02)      â”‚
â”‚ setState(selectedPC: PC-02)â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User clicks               â”‚
â”‚ "Request Access" button   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ handleRequestAccess()      â”‚
â”‚ requestPCAccess(pcId, ip)  â”‚ â—„â”€â”€â”€ Custom Hook
â”‚                            â”‚
â”‚ Updates DB:               â”‚
â”‚ 1. Create session record  â”‚
â”‚ 2. Update PC to pending   â”‚
â”‚ 3. Set IP address         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ session created
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ subscribeToSessionChanges()â”‚ â—„â”€â”€â”€ Custom Hook
â”‚ Listen for admin decision â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ setState(step: 'waiting')  â”‚
â”‚ Render waiting screen      â”‚
â”‚ Show pulsing animation     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€ Waiting...
     â”‚  (Admin portal)
     â”‚  Admin clicks GRANT
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Session status â†’ 'active'  â”‚
â”‚ Admin updated PC status    â”‚
â”‚ PC.session_started_at set  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ (Realtime pushes update)
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ subscribeToSessionChanges  â”‚
â”‚ fires callback             â”‚
â”‚ Detects status = 'active'  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ window.location.href = '/'         â”‚
â”‚ Auto-redirect to Landing Page      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Admin Flow: Page Load

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Load Admin Dashboard â”‚ (/admin/pc-management)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PCManagementAdmin    â”‚
â”‚ Component mounts     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ useEffect #1:            â”‚
â”‚ getAllPCs()              â”‚ â—„â”€â”€â”€ Custom Hook
â”‚ Query ALL pcs            â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ [PC-01, PC-02, ..., PC-08]
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ setPCs(allPCs)           â”‚
â”‚ setState(pcs: [...])     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ useEffect #2:            â”‚
â”‚ subscribeToPCChanges()   â”‚ â—„â”€â”€â”€ Custom Hook
â”‚ Setup realtime listener  â”‚
â”‚ Listens to pcs.* events  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€ Returns unsubscribe function
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ useEffect #3:            â”‚
â”‚ setInterval(1000ms)      â”‚
â”‚ Calculate elapsed times  â”‚
â”‚ for online PCs           â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Render Table:            â”‚
â”‚ âœ“ 5 filter tabs          â”‚
â”‚ âœ“ Table with all PCs     â”‚
â”‚ âœ“ Status dots + badges   â”‚
â”‚ âœ“ Running timers         â”‚
â”‚ âœ“ Action buttons         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€ Admin sees PC-02 pending
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Admin clicks GRANT buttonâ”‚
â”‚ on PC-02                 â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ handleGrantAccess()      â”‚
â”‚ grantAccess(pcId, sid)   â”‚ â—„â”€â”€â”€ Custom Hook
â”‚                          â”‚
â”‚ Updates DB:              â”‚
â”‚ 1. session.statusâ†’active â”‚
â”‚ 2. PC.statusâ†’online      â”‚
â”‚ 3. Set session_started   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Realtime pushes update   â”‚
â”‚ subscribeToPCChanges()   â”‚
â”‚ callback fires           â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ setPCs(updated)          â”‚
â”‚ PC-02 status now online  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Re-render table:         â”‚
â”‚ PC-02: OLD: Pending      â”‚
â”‚ PC-02: NEW: Onlineâœ…     â”‚
â”‚ PC-02: Time: 00:00:01    â”‚
â”‚ PC-02: Buttons: END/KICK â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â””â”€ Also: Customer's browser
        receives realtime update
        and auto-redirects
```

---

### Admin Action: GRANT vs DENY

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PENDING PC STATE                                       â”‚
â”‚  PC-02: status='pending', ip_address='192.168.1.102'   â”‚
â”‚  Session: status='pending'                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                      â”‚                      â”‚
     â–¼                      â–¼                      â–¼
  GRANT                    DENY              (No Action)
     â”‚                      â”‚                      â”‚
     â”‚                      â”‚                      â”‚
     â–¼                      â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ grantAccess()    â”‚  â”‚ denyAccess()     â”‚  â”‚ Stays pendingâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚              â”‚
â”‚ Updates:         â”‚  â”‚ Updates:         â”‚  â”‚ (unless auto-â”‚
â”‚ Sessions table:  â”‚  â”‚ Sessions table:  â”‚  â”‚  timeout)    â”‚
â”‚ statusâ†’'active'  â”‚  â”‚ statusâ†’'rejected'â”‚  â”‚              â”‚
â”‚ started_atâ†’NOW   â”‚  â”‚                  â”‚  â”‚              â”‚
â”‚                  â”‚  â”‚ pcs table:       â”‚  â”‚              â”‚
â”‚ pcs table:       â”‚  â”‚ statusâ†’'offline' â”‚  â”‚              â”‚
â”‚ statusâ†’'online'  â”‚  â”‚ ip_addressâ†’NULL  â”‚  â”‚              â”‚
â”‚ session_started_ â”‚  â”‚ current_session_ â”‚  â”‚              â”‚
â”‚ atâ†’NOW           â”‚  â”‚ idâ†’NULL          â”‚  â”‚              â”‚
â”‚ current_session_ â”‚  â”‚                  â”‚  â”‚              â”‚
â”‚ idâ†’sessionId     â”‚  â”‚                  â”‚  â”‚              â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                      â”‚
     â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NEW STATE:       â”‚  â”‚ NEW STATE:           â”‚
â”‚ PC-02: ONLINE    â”‚  â”‚ PC-02: OFFLINE       â”‚
â”‚ IP: kept (saved) â”‚  â”‚ IP: cleared (reset)  â”‚
â”‚ Timer: running   â”‚  â”‚ Timer: --:--:--      â”‚
â”‚ Buttons: END/KICKâ”‚  â”‚ Buttons: MAINT.      â”‚
â”‚                  â”‚  â”‚                      â”‚
â”‚ Customer:        â”‚  â”‚ Customer:            â”‚
â”‚ Auto-redirectâ†’/  â”‚  â”‚ Error message shown  â”‚
â”‚                  â”‚  â”‚ Back to selection    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Data Updates: END vs KICK

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ONLINE PC STATE                                          â”‚
â”‚ PC-01: status='online', ip='192.168.1.101'              â”‚
â”‚ Timer running: 00:15:32                                  â”‚
â”‚ Session: status='active', started_at=[15min ago]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                        â”‚                        â”‚
     â–¼                        â–¼                        â–¼
   END SESSION              KICK CLIENT            (Timeout)
     â”‚                        â”‚                        â”‚
     â”‚                        â”‚                        â”‚
     â–¼                        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ endSession()   â”‚    â”‚ kickClient()       â”‚    â”‚ Auto-end   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚            â”‚
â”‚ Updates:       â”‚    â”‚ Updates:           â”‚    â”‚ Updates:   â”‚
â”‚ Session:       â”‚    â”‚ Session:           â”‚    â”‚ Session:   â”‚
â”‚ statusâ†’'ended' â”‚    â”‚ statusâ†’'ended'     â”‚    â”‚ statusâ†’    â”‚
â”‚ ended_atâ†’NOW   â”‚    â”‚ ended_atâ†’NOW       â”‚    â”‚ 'ended'    â”‚
â”‚                â”‚    â”‚                    â”‚    â”‚            â”‚
â”‚ PC:            â”‚    â”‚ PC:                â”‚    â”‚ PC:        â”‚
â”‚ statusâ†’'offline'â”‚    â”‚ statusâ†’'offline'   â”‚    â”‚ statusâ†’    â”‚
â”‚ ip_address:    â”‚    â”‚ ip_addressâ†’NULL âœ“  â”‚    â”‚ 'offline'  â”‚
â”‚ UNCHANGED âœ“    â”‚    â”‚ current_sessionâ†’   â”‚    â”‚            â”‚
â”‚ current_sessionâ”‚    â”‚ NULL               â”‚    â”‚            â”‚
â”‚ â†’NULL          â”‚    â”‚                    â”‚    â”‚            â”‚
â”‚ session_startedâ”‚    â”‚                    â”‚    â”‚            â”‚
â”‚ â†’NULL          â”‚    â”‚                    â”‚    â”‚            â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                      â”‚
     â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NEW STATE:     â”‚    â”‚ NEW STATE:             â”‚
â”‚ PC-01: OFFLINE â”‚    â”‚ PC-01: OFFLINE         â”‚
â”‚ IP: 192.168... â”‚    â”‚ IP: (cleared)          â”‚
â”‚ Timer: --:--:--â”‚    â”‚ Timer: --:--:--        â”‚
â”‚ Buttons:       â”‚    â”‚ Buttons: MAINT.        â”‚
â”‚ MAINT.         â”‚    â”‚                        â”‚
â”‚                â”‚    â”‚ Customer:              â”‚
â”‚ Customer:      â”‚    â”‚ Must select new PC     â”‚
â”‚ "Resume Sessio"â”‚    â”‚ (IP no longer saved)   â”‚
â”‚ button next    â”‚    â”‚                        â”‚
â”‚ visit (IP kept)â”‚    â”‚ Next IP detected       â”‚
â”‚                â”‚    â”‚ â†’ PC selection         â”‚
â”‚ Same PC or new â”‚    â”‚   (not recognized)     â”‚
â”‚ one available  â”‚    â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Real-Time Event Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CUSTOMER PORTAL                                             â”‚
â”‚ (subscribeToSessionChanges listener)                        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼ Event: UPDATE sessions SET status='active'
     
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SUPABASE REALTIME LAYER                                     â”‚
â”‚ (PostgreSQL WAL â†’ WebSocket â†’ Subscribers)                  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Broadcast: { new: session, action: 'UPDATE' }
     
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ (100-500ms latency)                         â”‚
     â”‚                                             â”‚
     â–¼                                             â–¼
     
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CUSTOMER BROWSER     â”‚              â”‚ ADMIN BROWSER        â”‚
â”‚ subscriptor #1       â”‚              â”‚ subscriber #2        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                      â”‚
     â–¼                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Callback fired:      â”‚              â”‚ Callback fired:      â”‚
â”‚ "Session active!"    â”‚              â”‚ "PC online!"         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Status detected      â”‚              â”‚ Update table row     â”‚
â”‚ Redirect triggered   â”‚              â”‚ Re-render <TR>       â”‚
â”‚ window.location = '/'â”‚              â”‚ Timer starts: 00:00:01
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                      â”‚
     â–¼                                      â–¼
  LANDING PAGE                         TABLE UPDATED
  âœ… Customer sees                      âœ… Admin sees
     app                                  live changes
```

---

## ğŸ’¾ Database Operations Sequence

### Customer Request Flow

```
Step 1: Customer selects PC-02, IP: 192.168.1.102

INSERT INTO sessions (pc_id, ip_address, status)
VALUES (2, '192.168.1.102', 'pending')
RETURNING id;
â†’ session_id = 'abc-123-def'

Step 2: Update PC with request

UPDATE pcs
SET 
  ip_address = '192.168.1.102',
  status = 'pending',
  last_seen = NOW()
WHERE id = 2;

Step 3: Customer waits (listens to session)

SUBSCRIBE TO sessions
WHERE id = 'abc-123-def'
AND status â‰  'pending'

Step 4: Admin approves

UPDATE sessions
SET status = 'active', started_at = NOW()
WHERE id = 'abc-123-def';

UPDATE pcs
SET 
  status = 'online',
  session_started_at = NOW(),
  current_session_id = 'abc-123-def'
WHERE id = 2;

Step 5: Customer's subscription fires

Detected: status changed to 'active'
â†’ window.location.href = '/'
â†’ Auto-redirect
```

---

## ğŸ” State Machine Diagrams

### PC Status State Machine

```
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  OFFLINE (initial)   â”‚ â† Create PC here
         â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
            â”‚                 â”‚
    MAINTENANCEâ”‚              â”‚ REQUEST ACCESS
       setMaintâ”‚              â”‚ (IP not assigned
            â”‚                 â”‚  or resuming)
            â”‚                 â”‚
            â–¼                 â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚MAINT.   â”‚      â”‚  PENDING    â”‚
       â”‚(in      â”‚      â”‚  (waiting   â”‚
       â”‚repair)  â”‚      â”‚   approval) â”‚
       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
            â”‚                  â”‚
            â”‚ RESTORE          â”‚ GRANT  DENY
            â”‚                  â”‚  â”‚     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”˜     â”‚
                       â”‚                 â”‚
                       â–¼                 â–¼
                    OFFLINEâ†â”€ END â”€â†ONLINE
                   (available)  (active)
                       â–²
                       â”‚
                      KICK
                      (remove
                       IP)
                       
Legend:
OFFLINE     â†’ Available for new selection
PENDING     â†’ Waiting for admin approval
ONLINE      â†’ Active session in progress
MAINTENANCE â†’ Under repair, unavailable
```

### Session Status State Machine

```
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   PENDING    â”‚ â† Create session here
         â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
            â”‚         â”‚
       REJECTâ”‚        â”‚ GRANT
       (deny)â”‚        â”‚
            â”‚         â”‚
            â–¼         â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚REJECTEDâ”‚  â”‚ ACTIVE â”‚
       â”‚(denied)â”‚  â”‚(online)â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                       â”‚
                     END
                     (close
                      session)
                       â”‚
                       â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  ENDED   â”‚ â† Terminal state
                    â”‚ (closed) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± Component Hierarchy

```
App
â”œâ”€â”€ Route: /validate
â”‚   â””â”€â”€ IPValidation
â”‚       â”œâ”€â”€ State: step (detecting/checking/selection/waiting/error)
â”‚       â”œâ”€â”€ State: ip, selectedPC, session
â”‚       â”œâ”€â”€ useComputerShopDatabase hook
â”‚       â””â”€â”€ Render logic (5 different UIs based on step)
â”‚
â””â”€â”€ Route: /admin/pc-management
    â””â”€â”€ PCManagementAdmin
        â”œâ”€â”€ State: pcs[], filter, elapsedTimes, loading
        â”œâ”€â”€ useComputerShopDatabase hook
        â”œâ”€â”€ useEffect: Load PCs
        â”œâ”€â”€ useEffect: Subscribe to realtime
        â”œâ”€â”€ useEffect: Update timers (1sec)
        â”œâ”€â”€ FilterTabs (5 tabs with counts)
        â””â”€â”€ Table
            â”œâ”€â”€ Header row (PC | IP | STATUS | TIME | ACTION)
            â””â”€â”€ Data rows (for each PC)
                â”œâ”€â”€ PC Name Cell (+ AUTO badge)
                â”œâ”€â”€ IP Cell (code block or "Not assigned")
                â”œâ”€â”€ Status Cell (dot + badge)
                â”œâ”€â”€ Time Cell (timer or "--:--:--")
                â””â”€â”€ Action Cell (dynamic buttons)
```

---

## ğŸ“Š Performance Characteristics

```
Operation          â”‚ Time    â”‚ Notes
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
IP Detection       â”‚ 500ms   â”‚ External API call
                   â”‚         â”‚ Cached where possible
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
DB Query (single)  â”‚ 10-30ms â”‚ With indexes
                   â”‚         â”‚ Most queries use PK
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
DB Query (list)    â”‚ 20-50ms â”‚ 8 PCs is baseline
                   â”‚         â”‚ Scales well to 100+
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Realtime Update    â”‚ 100-500msâ”‚ Push from server
                   â”‚         â”‚ WebSocket latency
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
UI Render (small)  â”‚ <50ms   â”‚ PC grid, waiting screen
                   â”‚         â”‚ Simple components
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
UI Render (table)  â”‚ 50-200msâ”‚ 8-100 PC rows
                   â”‚         â”‚ Virtual scroll possible
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Timer Update       â”‚ 1000ms  â”‚ Every 1 second
                   â”‚         â”‚ JS interval loop
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Page Load          â”‚ 2-5s    â”‚ IP + DB query + render
                   â”‚         â”‚ (varies by network)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
End-to-End         â”‚ 100-2000msâ”‚ From GRANT to redirect
(grant to redirect)â”‚         â”‚ IP detection + DB + realtime
```

---

## ğŸ”Œ Hook Dependency Injection Pattern

```
Component A                    Component B
(IPValidation)                 (PCManagementAdmin)
     â”‚                              â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
        useComputerShopDatabase()
                â”‚
                â”œâ”€ Hides Supabase details
                â”œâ”€ Provides 15+ functions
                â”œâ”€ Manages loading/error state
                â””â”€ Handles subscriptions
                
Why this pattern:
âœ“ DRY - Logic in one place
âœ“ Testable - Easy to mock hook
âœ“ Reusable - Both components share
âœ“ Maintainable - Changes in one file
```

---

**Diagram Created**: March 1, 2026
**Updated**: [Current Date]
